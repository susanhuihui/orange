<!doctype html>
<html lang="zh-CN">
<head>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, minimum-scale=1.0, maximum-scale=1.0, user-scalable=no" />
    <meta name="description" content="">
    <meta name="author" content="">
    <link rel="icon" href="images/C_132.png">
    <title>在线教育</title>
    <link href="b/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" type="text/css" href="css/otherstyle.css" />
</head>

<body>
    {{template "menutop.html" .}}
    <div class="modal fade" id="selschooldiv" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel">
        <div class="modal-dialog" role="document">
            <div class="modal-content">
                <div class="modal-header">
                    <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
                    <h3 style="font-size: 16px; font-weight: bold;" class="modal-title">选择学校</h3>
                </div>
                <div class="modal-body">
                    <table class="stutablepop" style="text-align: left;">
                        <tr>
                            <td id="prolists"></td>
                        </tr>
                        <tr>
                            <td id="citylists"></td>
                        </tr>
                        <tr>
                            <td style="border-bottom: 1px solid #E7E7E7;" id="contLists"></td>
                        </tr>
                        <tr>
                            <td id="schoollists"></td>
                        </tr>
                    </table>
                </div>
                <div class="modal-footer" style="text-align: center;">
                    <button type="button" style="width: 30%;" class="btn btn-warning" data-dismiss="modal" onclick="showSchoolname()">确定</button>
                    <button type="button" style="width: 30%;" class="btn btn-default" data-dismiss="modal">取消</button>
                </div>
            </div>
        </div>
    </div>

    <div id="bg" class="bg" style="display: none;"></div>
    <div id="pagetopb">
        <!--个人资料-->
        <form method="post" action="http://{{.Website}}/orange/Main/UpdateTeacher/" enctype="multipart/form-data"  onsubmit="return check()">
            <div class="container" style="margin-top: 20px; background-color: #FFFFFF; padding-top: 20px;">
                <div>
                        <div class=" col-sm-4" style="background-color: #FFFFFF; float: left;">
                            <ul id="tabnav">
                                <li><a id="limenu1" class="active" onclick="qiehuantap(1)">基本信息</a></li>
                                <li><a id="limenu2" class="" onclick="qiehuantap(2)">账号设置</a></li>
                                <li><a id="limenu3" class="" onclick="qiehuantap(3)">修改密码</a></li>
                            </ul>
                        </div>
                        <div class="col-sm-8" id="tab_content" style="height: 1500px;">
                            <div id="divtap1" class="content">
                                <div class="row">
                                    <input type="button" style="float: right;" class="btn btn-default" value="编辑" onclick="bianji()">
                                </div>
                                <div class="row message">
                                    <div class="col-xs-4 perfont">
                                        照片:
                                    </div>
                                    <div class="col-xs-8">
                                        <img id="userhead" src="{{.AvatarPath}}" style="width: 120px; height: 125px;" />
                                        <input type="file" accept="image/*" id="file_image" name="file_image" style="display: none;" onchange="setImagePreview()" /><input type="file" style="display: none;"  id="file" name="file" onchange="setImagePreview2()" />
                                        <!--<input type="submit" id="file_form" name="file_form" value="提交上传" style="display: none;" />
                                        <p id="userheadpath" style="display: none;">{{.AvatarPath}}</p>
                                        <script type="text/javascript">
                                            (function (W, D) {
                                                var fileForm = document.getElementById("file_form");
                                                var fileImage = document.getElementById("file_image");
                                                function testAjax(files, i) {
                                                    if (i < 0) {
                                                        return;
                                                    }
                                                    var xhr = new XMLHttpRequest(),
                                                         data = new FormData();
                                                    xhr.onload = function () {
                                                        // 递归
                                                        testAjax(files, --i);
                                                    };
                                                    data.append("file1", files[i]);
                                                    xhr.open("post", "http://{{.Website}}/orange/userinformation/UpdateUserimg/" + getCookie("userid"), true);
                                                    xhr.send(data);
                                                }
                                                fileForm.addEventListener("click", function (e) {
                                                    e.preventDefault();
                                                    var files = fileImage.files;
                                                    testAjax(files, --files.length);
                                                }, false);
                                            })(window, document);
                                        </script>-->
                                    </div>
                                </div>
                                <div class="row message">
                                    <div class="col-xs-4 perfont">
                                        姓名:                                   
                                    </div>
                                    <div class="col-xs-6">
                                        <span id="username">{{.UserName}} </span>
                                        <input class="form-control" type="text" id="txtUserName" name="txtUserName" style="display: none;" value="{{.UserName}}" onchange="checkname()" />
                                    </div>
                                </div>
                                <div class="row message">
                                    <div class="col-xs-4 perfont">
                                        性别:                                   
                                    </div>
                                    <div class="col-xs-6">
                                        <span id="usersex">{{.UserSex}}</span>
                                        <select class="form-control" id="selUserSex" name="selUserSex" style="display: none;">
                                            <option value="男">男</option>
                                            <option value="女">女</option>
                                        </select>

                                    </div>
                                </div>
                                <div class="row message">
                                    <div class="col-xs-4 perfont">
                                        高中所在学校:                                   
                                    </div>
                                    <div class="col-xs-6">
                                        <span id="txthighschoolname">{{.HighSchoolName}}</span>
                                        <select class=" form-control" id="selProvence" onchange="selcityByPchange()" style="display: none">
                                            <option value="0"></option>
                                        </select>
                                        <select class="form-control" id="selCitys" name="selCitys" onchange="selAllcitys()" style="display: none">
                                            <option value="0"></option>
                                        </select>
                                        <input class="form-control" type="text" id="txthighschool" name="txthighschool" style="display: none;" value="{{.HighSchoolName}}" />
                                        <a data-toggle="modal" data-target="#selschooldiv" style="display: none;" id="btnbianjihigh">
                                            <span style="color: red" onclick="getprovence(3)">编辑</span><!--中小学0，大学1-->
                                        </a>
                                    </div>
                                </div>
                                <div class="row message">
                                    <div class="col-xs-4 perfont">
                                        所在大学:                                   
                                    </div>
                                    <div class="col-xs-6">
                                        <span id="txtschoolname">{{.SchoolName}}</span>
                                        <input class="form-control" type="text" id="txtnowschoolname" name="txtnowschoolname" style="display: none;" value="{{.SchoolName}}" />
                                        <a data-toggle="modal" data-target="#selschooldiv" style="display: none;" id="btnbianji">
                                            <span style="color: red" onclick="getprovence(1)">编辑</span>
                                        </a>
                                    </div>
                                </div>
                                <div class="row message">
                                    <div class="col-xs-4 perfont">
                                        大学入学年份:                                   
                                    </div>
                                    <div class="col-xs-6">
                                        <span id="ruxueyear">{{.LevelYear}}</span>
                                        <input class="form-control" type="text" id="txtruxueyear" name="txtruxueyear" style="display: none;" value="{{.LevelYear}}" />
                                    </div>
                                </div>
                                <div class="row message">
                                    <div class="col-xs-4 perfont">
                                        用户邮箱:                                   
                                    </div>
                                    <div class="col-xs-6">
                                        <span id="youxiang">{{.Mailbox}}</span>
                                        <input class="form-control" type="text" id="txtusermail" name="txtusermail" style="display: none;" value="{{.Mailbox}}" />
                                    </div>
                                </div>
                                <div class="row message">
                                    <div class="col-xs-4 perfont">
                                        学位:                                   
                                    </div>
                                    <div class="col-xs-6">
                                        <span id="txtagename">{{.DegreeName}}</span>
                                        <select class="form-control" id="selDegree" name="selDegree" style="display: none;">
                                        </select>
                                    </div>
                                </div>
                                <div class="row message">
                                    <div class="col-xs-4 perfont">
                                        大学所学专业:                                   
                                    </div>
                                    <div class="col-xs-6">
                                        <span id="Professional">{{.Professional}}</span>
                                        <input class="form-control" type="text" id="txtProfessional" name="txtProfessional" style="display: none;" value="{{.Professional}}" />
                                    </div>
                                </div>
                                <div class="row message" style="display: none;">
                                    <div class="col-xs-4 perfont">
                                        补习年级:                                   
                                    </div>
                                    <div class="col-xs-6">
                                        <span id="showgrid">{{.GradeName}}</span>
                                        <select class="form-control" id="selgrid" style="display: none;">
                                        </select>
                                    </div>
                                </div>
                                <div class="row message">
                                    <div class="col-xs-4 perfont">
                                        补习学龄段:                                   
                                    </div>
                                    <div class="col-xs-6">
                                        <span id="txtsage">{{.AgeNames}}</span>
                                        <div class="col-xs-8" id="selSchoolage" style="display: none;">
                                        </div>
                                    </div>
                                </div>
                                <div class="row message">
                                    <div class="col-xs-4 perfont">
                                        主辅导科目:                                   
                                    </div>
                                    <div class="col-xs-6">
                                        <span id="txtzhucourse">{{.CourseName}}</span>
                                        <select class="form-control" id="selcourse" name="selcourse" style="display: none;">
                                        </select>
                                    </div>
                                </div>
                                <div class="row message">
                                    <div class="col-xs-4 perfont">
                                        辅辅导科目:                                   
                                    </div>
                                    <span id="txtfucourse">{{.userclassstr}}</span>
                                    <div class="col-xs-8" id="selClass" style="display: none;">
                                    </div>
                                </div>
                                <div class="row message">
                                    <div class="col-xs-4 perfont">
                                        个人简介:                                   
                                    </div>
                                    <div class="col-xs-6">
                                        <span id="showjianjie">{{.BriefIntroduction}}</span>
                                        <textarea class="form-control evaareass" id="txtjianjie" name="txtjianjie" style="display: none;">{{.BriefIntroduction}}</textarea>
                                    </div>
                                </div>
                                <div class="row message">
                                    <div class="col-xs-4 perfont">
                                        兴趣爱好:
                                   
                                    </div>
                                    <div class="col-xs-6">
                                        <span id="showaihao">{{.UserHobby}}</span>
                                        <textarea class="form-control evaareass" id="txtaihao" name="txtaihao" style="display: none;">{{.UserHobby}}</textarea>
                                    </div>
                                </div>
                                <div class="row message">
                                    <div class="col-xs-4 perfont">
                                        &nbsp;
                                   
                                    </div>
                                    <div class="col-xs-8">
                                        <input id="btnjiben" class="evabtn messagebtn" style="display: none;" type="submit" value="保存信息" onclick="saveUserInfo()">
                                    </div>
                                </div>

                                <div>
                                </div>
                            </div>
                            <div id="divtap2" class="content" style="display: none;">
                                <div class="row messagesss">
                                    <div class="col-xs-4 perfont">
                                        手机号:                                   
                                    </div>
                                    <div class="col-xs-8">
                                        <span id="olduserphone">{{.IphoneNum}}</span>
                                        &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="###" onclick="openShutManager(this,'box')" style="text-decoration: underline; color: #0026ff;">更改手机号</a>
                                        <div id="box" style="display: none;">
                                            <table style="width: 100%;">
                                                <tr>
                                                    <td class="odd">手机号：   
                                                    </td>
                                                    <td class="even">
                                                        <input type="text" class="regtext" id="upuserphone" onblur="upColor()"  onkeydown="javascript:if(event.keyCode==13) return false;" >
                                                    </td>
                                                </tr>
                                                <tr>
                                                    <td class="odd">验证码：   
                                                    </td>
                                                    <td class="even">
                                                        <input type="text" class="yzmtext" id="upyanzhengma" onkeydown="javascript:if(event.keyCode==13) return false;" >
                                                        <input type="button" class="yzmbtn" id="getyanzheng" value="点击获取验证码" disabled="disabled" >
                                                        <script type="text/javascript">
                                                            var wait = 60;
                                                            function time(o) {
                                                                if (wait == 0) {
                                                                    o.removeAttribute("disabled");
                                                                    o.value = "点击获取验证码";
                                                                    wait = 60;
                                                                } else {
                                                                    o.setAttribute("disabled", true);
                                                                    o.value = "重新发送(" + wait + ")";
                                                                    wait--;
                                                                    if (wait == 0) {
                                                                        delPhoneVerifica();
                                                                    }
                                                                    setTimeout(function () {
                                                                        time(o)
                                                                    },
                                                                    1000)
                                                                }
                                                            }
                                                            document.getElementById("getyanzheng").onclick = function () { getYzCode();  }
                                                        </script>
                                                    </td>
                                                </tr>
                                            </table>
                                        </div>
                                    </div>
                                </div>
                                <div class="row message">
                                    <div class="col-xs-4 perfont">
                                        &nbsp;
                                   
                                    </div>
                                    <div class="col-xs-8">
                                        <input class="evabtn messagebtn" type="button" value="保存信息" onclick="saveUserPhone()">
                                    </div>
                                </div>

                            </div>
                            <div id="divtap3" class="content" style="display: none;">
                                <div class="row messagesss">
                                    <div class="col-xs-4 perfont">
                                        手机号:                                   
                                    </div>
                                    <div class="col-xs-8">
                                        {{.IphoneNum}}                                     
                                    </div>
                                </div>
                                <div class="row messagesss">
                                    <div class="col-xs-4 perfonts">
                                        原密码:                                   
                                    </div>
                                    <div class="col-xs-8">
                                        <input class="form-control" type="password" id="oldpass" onkeydown="javascript:if(event.keyCode==13) return false;" >
                                    </div>
                                </div>
                                <div class="row messagesss">
                                    <div class="col-xs-4 perfonts">
                                        新密码:                                   
                                    </div>
                                    <div class="col-xs-8">
                                        <input class="form-control" type="password" id="newpass1" onkeydown="javascript:if(event.keyCode==13) return false;" >
                                    </div>
                                </div>
                                <div class="row messagesss">
                                    <div class="col-xs-4 perfonts">
                                        再次输入新密码:                                   
                                    </div>
                                    <div class="col-xs-8">
                                        <input class="form-control" type="password" id="newpass2" onkeydown="javascript:if(event.keyCode==13) return false;" >
                                    </div>
                                </div>
                                <div class="row message">
                                    <div class="col-xs-4 perfont">
                                        &nbsp;                                   
                                    </div>
                                    <div class="col-xs-8">
                                        <input class="evabtn messagebtn" type="button" value="保存信息" id="btnSavePass" onclick="saveUserPass()">
                                    </div>
                                </div>
                            </div>
                            <p id="userlistclass" style="display: none;">{{.userlistclass}}</p>
                            <p id="schoolagelist" style="display: none;">{{.schoolagelist}}</p>
                            <p id="UserDegree" style="display: none;">{{.UserDegree}}</p>
                            <!--学位-->
                            <p id="GradeId" style="display: none;">{{.GradeId}}</p>
                            <!--补习年级id-->
                            <p id="CourseNameId" style="display: none;">{{.CourseNameId}}</p>
                            <!--主辅导课程id-->

                            <p id="SchoolId" style="display: none;">{{.SchoolId}}</p>
                            <!--将要被保存的学校id，没有选择时还保存最初值-->
                            <p id="selSchoolId" style="display: none;">{{.SchoolId}}</p>
                            <!--暂时存放选中的学校id，点击确定后从此取值放入上面，保存时取上方p值-->
                            <p id="selSchoolName" style="display: none;">{{.SchoolName}}</p>
                            <!--暂时存放选中的学校名称，点击确定后取值放入span,与保存无关-->

                            <p id="highSchoolid" style="display: none;">{{.SeniorLocation}}</p>
                            <p id="selHighSchoolid" style="display: none;">{{.SeniorLocation}}</p>
                            <p id="selHighSchoolName" style="display: none;">{{.HighSchoolName}}</p>
                        </div>
                </div>
            </div>
        </form>
    </div>
    {{template "footer.html" .}}
    <script src="b/js/jquery.min.js"></script>
    <!--<script src="b/js/bootstrap.min.js"></script>-->
    <script type="text/javascript" src="js/personal.js"></script>
    <script type="text/javascript" src="js/main.js"></script>
    <script type="text/javascript" src="js/indexjs.js"></script>
    <script type="text/javascript" src="js/orange.js"></script>
    <script type="text/javascript" src="js/jquery-1.3.1.js"></script>
    <script type="text/javascript">
        var userid = getCookie("userid")//获取登录用户主键id
        var identityid = getCookie("identityid");
        window.onload = function () {
            getuser();
            setTitleOnSelect(4);
            if (userid == null || userid <= 0) {
                window.location.href = "http://{{.Website}}/";
            }
            chushi();
            getuserhead();
        }

        function getuserhead() {
            var srcurl = "{{.AvatarPath}}";
            if (srcurl == null || srcurl + "" == "") {
                document.getElementById("userhead").src = "images/PersonHeadImg/moren.png";
            } else {
                document.getElementById("userhead").src = srcurl;
            }
        }
        //省份onchange事件级联市
        function selcityByPchange() {
            var selpid = document.getElementById("selProvence").value;
            //alert(selpid);
            getCityByPid(selpid);
            if (selpid > 0) {
                var selectIndex = document.getElementById("selProvence").selectedIndex;
                var selProvinceStr = document.getElementById("selProvence").options[selectIndex].text;
                pubPro = selProvinceStr;
            } else {
                pubPro = "";//请选择
                pubCitys = "";
            }
            var hrefpub = "http://{{.Website}}/orange/Teacher/TeacherList/" + pubTab + "&" + pubGrade + "&" + pubCourse + "&" + pubLevel + "&" + pubPro + "&" + pubCitys + "&" + "1" + "&" + pubRows;
            window.location.href = hrefpub;
        }
        //市区onchange事件级联市
        function selAllcitys() {
            var selpid = document.getElementById("selCitys").value;
            //alert(selpid);
            if (selpid > 0) {
                var selectIndex = document.getElementById("selCitys").selectedIndex;
                var selCityStr = document.getElementById("selCitys").options[selectIndex].text;
                pubCitys = selCityStr;
            } else {
                pubCitys = "";
            }
            var hrefpub = "http://{{.Website}}/orange/Teacher/TeacherList/" + pubTab + "&" + pubGrade + "&" + pubCourse + "&" + pubLevel + "&" + pubPro + "&" + pubCitys + "&" + "1" + "&" + pubRows;
            window.location.href = hrefpub;
        }
        //根据省份查询市区
        function getCityByPid(pid) {
            if (pid > 0) {
                var allLevel = "http://{{.Website}}/orange/citys/GetCitysByPid/" + pid;
                $.getJSON(allLevel, function (data) {
                    var levelstr = '<option value="0">请选择</option>';
                    for (var i = 0; i < data.length ; i++) {
                        var items = '<option value="' + data[i]["Id"] + '">' + data[i]["CityName"] + '</option>';
                        levelstr += items;
                    }
                    document.getElementById("selCitys").innerHTML = "";
                    $("#selCitys").append(levelstr);
                });
            }
            else {
                var levelstr = '<option value="">请选择</option>';
                document.getElementById("selCitys").innerHTML = "";
                $("#selCitys").append(levelstr);
            }
            //getAllTeacher(1);
        }
        //初始选择时的列表信息
        function chushi() {
            //查询全部省份
            var allLevel = "http://{{.Website}}/orange/province/GetAllProvince/1/100/";
            //var shengfen = document.getElementById("P5").innerText; pubPro = shengfen;
            $.getJSON(allLevel, function (data) {
                var levelstr = '<option value="0">请选择</option>';
                for (var i = 0; i < data.length ; i++) {
                    var items = '<option value="' + data[i]["Id"] + '">' + data[i]["ProName"] + '</option>';//
                    levelstr += items;
                }
                document.getElementById("selProvence").innerHTML = "";
                $("#selProvence").append(levelstr);

                var highsid = document.getElementById("highSchoolid").innerHTML;//当前老师市区主键id
                var yanzhengpass = "http://{{.Website}}/orange/citys/GetCitysById/" + highsid;
                $.getJSON(yanzhengpass, function (datacity) {
                    if (datacity["Id"] > 0) {
                        selectValue("selProvence", datacity["ProId"]);//选中老师学校的省
                        getCityByPid(datacity["ProId"]);//根据省份查询市区
                        selectValue("selCitys", highsid);
                    }
                });

            });

            var allClass = "http://{{.Website}}/orange/course/GetAllCourse/1/100/";
            $.getJSON(allClass, function (data) {
                var classte = document.getElementById("userlistclass").innerText;
                var usli = classte.split(',');
                var coursestr = '';
                for (var i = 0; i < data.length ; i++) {
                    var check = "";
                    for (var j = 0; j < usli.length; j++) {
                        if (usli[j] == data[i]["Id"]) {
                            check = ' checked = "checked" ';
                        }
                    }
                    var items = '<input type="checkbox" name="selckclass" value="' + data[i]["Id"] + '" id="ckclass' + i + '" ' + check + '>' + data[i]["CourseName"] + '&nbsp;&nbsp;&nbsp; ';
                    coursestr += items;
                }
                document.getElementById("selClass").innerHTML = "";
                $("#selClass").append(coursestr);
            }); 
            var allSccage = "http://{{.Website}}/orange/schoolages/GetAllSchoolages/1/100/";
            $.getJSON(allSccage, function (dataage) {
                var classte = document.getElementById("schoolagelist").innerText;
                var usli = classte.split(',');
                var courseagestr = '';
                for (var i = 0; i < dataage.length ; i++) {
                    var check = "";
                    for (var j = 0; j < usli.length; j++) {
                        if (usli[j] == dataage[i]["Id"]) {
                            check = ' checked = "checked" ';
                        }
                    }
                    var items = '<input type="checkbox" name="ageTeacher" value="' + dataage[i]["Id"] + '" id="ckage' + i + '" ' + check + '>' + dataage[i]["AgeName"] + '&nbsp;&nbsp;&nbsp; ';
                    courseagestr += items;
                }
                document.getElementById("selSchoolage").innerHTML = "";
                $("#selSchoolage").append(courseagestr);
            });
            var alldegree = "http://{{.Website}}/orange/degree/GetAllDegree/1/100/";
            $.getJSON(alldegree, function (data) {
                var coursestr = '';
                for (var i = 0; i < data.length ; i++) {
                    var items = '<option value="' + data[i]["Id"] + '">' + data[i]["DegreeName"] + '</option>';
                    coursestr += items;
                }
                document.getElementById("selDegree").innerHTML = "";
                $("#selDegree").append(coursestr);
            });
            //var allgrade = "http://{{.Website}}/orange/grade/GetAllGrade/1/100/";
            //$.getJSON(allgrade, function (data) {
            //    var coursestr = '';
            //    for (var i = 0; i < data.length ; i++) {
            //        var items = '<option value="' + data[i]["Id"] + '">' + data[i]["GradeName"] + '</option>';
            //        coursestr += items;
            //    }
            //    document.getElementById("selgrid").innerHTML = "";
            //    $("#selgrid").append(coursestr);
            //});
            var allcourse = "http://{{.Website}}/orange/course/GetAllCourse/1/100/";
            $.getJSON(allcourse, function (data) {
                var coursestr = '';
                for (var i = 0; i < data.length ; i++) {
                    var items = '<option value="' + data[i]["Id"] + '">' + data[i]["CourseName"] + '</option>';
                    coursestr += items;
                }
                document.getElementById("selcourse").innerHTML = "";
                $("#selcourse").append(coursestr);
            });
        }
        var hightypeid = 0;//查询高校，还是大学,中小学0，大学1
        //初始省份信息
        function getprovence(hightype) {
            hightypeid = hightype;//设置查询学校类型
            //查询全部省份
            var allProvince = "http://{{.Website}}/orange/province/GetAllProvince/1/100/";
            $.getJSON(allProvince, function (data) {
                var levelstr = '<p style="color:red;">省份：</p>';
                for (var i = 0; i < data.length ; i++) {
                    var items = '<a id="" onclick="getcity(' + data[i]["Id"] + ')">' + data[i]["ProName"] + '</a> &nbsp;&nbsp;';
                    levelstr += items;
                }
                document.getElementById("prolists").innerHTML = "";
                $("#prolists").append(levelstr);
                getcity(data[0]["Id"]);
            });
        }

        //根据省份id获取城市信息
        function getcity(pid) {
            if (pid > 0) {
                var allCitys = "http://{{.Website}}/orange/citys/GetCitysByPid/" + pid;
                $.getJSON(allCitys, function (data) {
                    var levelstr = '<p style="color:red;">市：</p>';
                    if (data != null && data.length > 0) {
                        if (hightypeid == 3) {
                            for (var i = 0; i < data.length ; i++) {
                                var items = '<a id="" onclick="getcontry(' + data[i]["Id"] + ')">' + data[i]["CityName"] + '</a> &nbsp;&nbsp;';
                                levelstr += items;
                            }
                            document.getElementById("citylists").innerHTML = "";
                            $("#citylists").append(levelstr);
                            getcontry(data[0]["Id"]);
                        }
                        else if (hightypeid == 1) {
                            for (var i = 0; i < data.length ; i++) {
                                var items = '<a id="" onclick="getSchool(' + data[i]["Id"] + ')">' + data[i]["CityName"] + '</a> &nbsp;&nbsp;';
                                levelstr += items;
                            }
                            document.getElementById("citylists").innerHTML = "";
                            $("#citylists").append(levelstr);
                            document.getElementById("contLists").innerHTML = "";
                            getSchool(data[0]["Id"]);
                        }
                    } else {
                        document.getElementById("citylists").innerHTML = "";
                        $("#citylists").append(levelstr);
                        document.getElementById("contLists").innerHTML = "";
                        $("#contLists").append('<p style="color:red;">区县：</p>');
                        document.getElementById("schoollists").innerHTML = "";
                        $("#schoollists").append('<p style="color:red;">学校：</p>');
                    }
                });
            }
            else {
                var levelstr = '<option value="">请选择</option>';
                document.getElementById("selCitys").innerHTML = "";
                $("#selCitys").append(levelstr);
            }
        }
        //根据市主键id获取之下的所有区县
        function getcontry(cid) {
            var allContry = "http://{{.Website}}/orange/countys/GetCountysByCid/" + cid;
            $.getJSON(allContry, function (data) {
                var levelstr = '<p style="color:red;">区县：</p>';
                if (data != null && data.length > 0) {
                    for (var i = 0; i < data.length ; i++) {
                        var items = '<a id="" onclick="getSchool(' + data[i]["Id"] + ')">' + data[i]["CountyName"] + '</a> &nbsp;&nbsp;';
                        levelstr += items;
                    }
                }
                document.getElementById("contLists").innerHTML = "";
                $("#contLists").append(levelstr);
                getSchool(data[0]["Id"]);
            });
        }
        //根据区获取学校
        function getSchool(cid) {
            var allschool = "http://{{.Website}}/orange/schools/GetSchoolsByCity/" + cid + "/" + hightypeid;
            $.getJSON(allschool, function (data) {
                var levelstr = '<p style="color:red;">学校：</p>';
                //alert(data);
                if (data != null && data.length > 0) {
                    for (var i = 0; i < data.length ; i++) {
                        var items = '<a id="" onclick="getSchoolId(' + data[i]["Id"] + ',' + "'" + data[i]["SchoolName"] + "')" + '">' + data[i]["SchoolName"] + '</a> &nbsp;&nbsp;';
                        levelstr += items;
                    }
                }
                document.getElementById("schoollists").innerHTML = "";
                $("#schoollists").append(levelstr);
            });
        }

        //根据选择的学校id显示学校名称
        function getSchoolId(sid, schoolname) {
            if (hightypeid == 3) {//高中
                document.getElementById("selHighSchoolid").innerText = sid;
                document.getElementById("selHighSchoolName").innerText = schoolname;
            } else {//大学
                document.getElementById("selSchoolId").innerText = sid;
                document.getElementById("selSchoolName").innerText = schoolname;
            }
        }

        //点击确定后显示学校名字并绑定选择的学校主键
        function showSchoolname() {
            if (hightypeid == 3) {//高中
                var hid = document.getElementById("selHighSchoolid").innerText;
                var hname = document.getElementById("selHighSchoolName").innerText;
                document.getElementById("highSchoolid").innerText = hid;
                document.getElementById("txthighschoolname").innerText = hname;
            } else {//大学
                var id = document.getElementById("selSchoolId").innerText;
                var name = document.getElementById("selSchoolName").innerText;
                document.getElementById("SchoolId").innerText = id;
                document.getElementById("txtschoolname").innerText = name;
            }
        }
        function selectValue(sId, value) {
            var s = document.getElementById(sId);
            var ops = s.options;
            for (var i = 0; i < ops.length; i++) {
                var tempValue = ops[i].value;
                if (tempValue == value) {
                    ops[i].selected = true;
                }
            }
        }
        //编辑按钮，修改为编辑状态
        function bianji() {
            //查询老师高中所在学校市区主键，设置省市级联为当前老师数据
            var highsid = document.getElementById("highSchoolid").innerHTML;//当前老师市区主键id
            selectValue("selCitys", highsid);

            //document.getElementById("btnbianji").style.display = "block";//学校编辑按钮
            //document.getElementById("btnbianjihigh").style.display = "block";
            document.getElementById("txthighschoolname").style.display = "none";
            document.getElementById("txthighschool").style.display = "block";
            document.getElementById("selProvence").style.display = "block"; 
            document.getElementById("selCitys").style.display = "block"; 
            document.getElementById("txtschoolname").style.display = "none";
            document.getElementById("txtnowschoolname").style.display = "block";

            document.getElementById("txtUserName").style.display = "block";//姓名
            document.getElementById("username").style.display = "none";
            var setsex = document.getElementById("usersex").innerText;//性别
            if (setsex != "") {
                document.getElementById("selUserSex").style.display = "block";
                document.getElementById("usersex").style.display = "none";
                document.getElementById("selUserSex").value = setsex;
            } else {
                document.getElementById("selUserSex").style.display = "block";
                document.getElementById("usersex").style.display = "none";
            }
            var setage = document.getElementById("UserDegree").innerText;//学位id
            if (setage != "") {
                document.getElementById("selDegree").style.display = "block";
                document.getElementById("txtagename").style.display = "none";
                document.getElementById("selDegree").value = setage;
            }
            document.getElementById("ruxueyear").style.display = "none"; //入学年份
            document.getElementById("txtruxueyear").style.display = "block";
            document.getElementById("youxiang").style.display = "none";//邮箱
            document.getElementById("txtusermail").style.display = "block";
            document.getElementById("Professional").style.display = "none";//专业
            document.getElementById("txtProfessional").style.display = "block"; 
            document.getElementById("txtsage").style.display = "none";//补习学龄段
            document.getElementById("selSchoolage").style.display = "block";
            //var gradeid = document.getElementById("GradeId").innerText;//年级id
            //if (gradeid != "") {
                //document.getElementById("selgrid").style.display = "block";
                //document.getElementById("showgrid").style.display = "none";
                //document.getElementById("selgrid").value = gradeid;
            //}
            var zhucourseid = document.getElementById("CourseNameId").innerText;//主辅导课程id
            if (zhucourseid != "") {
                document.getElementById("selcourse").style.display = "block";
                document.getElementById("txtzhucourse").style.display = "none";
                document.getElementById("selcourse").value = zhucourseid;
            }
            document.getElementById("file").style.display = "block";//更改头像按钮
            //document.getElementById("file_form").style.display = "block";//更改头像按钮
            document.getElementById("btnjiben").style.display = "block";//保存信息按钮

            document.getElementById("txtfucourse").style.display = "none";//辅辅导课程文字隐藏
            document.getElementById("selClass").style.display = "block";//辅辅导课程checkbox选项显示
            document.getElementById("showjianjie").style.display = "none";//文字隐藏
            document.getElementById("txtjianjie").style.display = "block";//选项显示
            document.getElementById("showaihao").style.display = "none";//文字隐藏
            document.getElementById("txtaihao").style.display = "block";//选项显示             
        }

        //保存用户基本信息
        function saveUserInfo() {
            var username = trim(document.getElementById("txtUserName").value);
            var usersex = document.getElementById("selUserSex").value;
            //var userheighschoolid = document.getElementById("highSchoolid").innerText;//高中id
            var heighshoolName = document.getElementById("txthighschool").value;//高中名称对应HighSchool
            var schoolname = document.getElementById("txtnowschoolname").value;//当前所在学校名称对应SchoolName
            var userheighschoolid = document.getElementById("selCitys").value;//高中市区id
            //var userschoolid = document.getElementById("SchoolId").innerText;//大学id暂时无用 
            var useryear = document.getElementById("txtruxueyear").value;
            var usermail = document.getElementById("txtusermail").value;
            var userdegree = document.getElementById("selDegree").value;//学位
            var userprofess = document.getElementById("txtProfessional").value;//学习专业
            //var usergrade = document.getElementById("selgrid").value;//辅导年级
            var userZhuCourse = document.getElementById("selcourse").value;//主辅导科目--需要另外的方法保存
            var userjianjie = document.getElementById("txtjianjie").value;
            var userhobby = document.getElementById("txtaihao").value;
            var userhead = "";
            var head = document.getElementById("userheadpath").innerText;
            if (head + "" != "" && head + "" != "undefined") {
                userhead = head;
            }
            //获取选取选中的补习学龄段
            var allselageid = "";
            for (var i = 0; i < 3; i++) {
                var items = document.getElementById("ckage" + i);
                if (items != null) {
                    if (items.checked) {
                        allselageid = allselageid + items.value + ",";
                    }
                }
            }
            allselageid = allselageid.substring(0, allselageid.length - 1);
            
            if (!userheighschoolid > 0) { alert("请选择高中所在学校所在地！"); return;}
            var yanzhengpass = "http://{{.Website}}/orange/userinformation/GetUserinformationById/" + userid;
            $.getJSON(yanzhengpass, function (datauser) {
                var upuser = '{' +
                    '"UserName":"' + username + '",' +
                    '"IphoneNum":"' + datauser["IphoneNum"] + '",' +
                    '"LoginPassword":"' + datauser["LoginPassword"] + '",' +
                    '"PayPassword":"' + datauser["PayPassword"] + '",' +
                    '"UserSex":"' + usersex + '",' +
                    '"SchoolId":' + datauser["SchoolId"] + ',' +
                    '"SchoolName":"' + schoolname + '",' +
                    '"SchoolAgeId":' + datauser["SchoolAgeId"] + ',' +
                    '"UserDegree":' + userdegree + ',' +
                    '"UserLocation":' + datauser["UserLocation"] + ',' +
                    '"SeniorLocation":' + userheighschoolid + ',' +
                    '"HighSchool":"' + heighshoolName + '",' +
                    '"UserLevelId":' + datauser["UserLevelId"] + ',' +
                    '"LevelYear":' + useryear + ',' +
                    '"IdentityId":' + datauser["IdentityId"] + ',' +
                    '"GradeId":' + datauser["GradeId"] + ',' +
                    '"SchoolAgeIdT":"' + allselageid + '",' +
                    '"UnitPrice":' + datauser["UnitPrice"] + ',' +
                    '"Professional":"' + userprofess + '",' +
                    '"Mailbox":"' + usermail + '",' +
                    '"ParentMailbox":"' + datauser["ParentMailbox"] + '",' +
                    '"StudyDifficult":"' + datauser["StudyDifficult"] + '",' +
                    '"AvatarPath":"' + userhead + '",' +
                    '"UserHobby":"' + userhobby + '",' +
                    '"Remarks":"' + datauser["Remarks"] + '",' +
                    '"BriefIntroduction":"' + userjianjie + '",' +
                    '"RegisteredTime":"' + getInsertDate(datauser["RegisteredTime"]) +
                '"}';
                $.post("http://{{.Website}}/orange/userinformation/UpdateUserinformationById/" + userid, upuser,
                   function (data) {
                       if (data == "OK") {
                           //-------------保存主辅导课程
                           //if (userZhuCourse > 0) {
                           //    alert(userZhuCourse);
                           //    var uerzhucourse = "http://{{.Website}}/orange/remedialcourses/GetRemedialcoursesMain/" + userid + "/1";//查询这个老师是否有主辅导课程
                           //    alert(uerzhucourse);
                           //    $.getJSON(uerzhucourse, function (datacourse) {
                           //        alert(datacourse);
                           //        if (datacourse == null || datacourse.length <= 0 || datacourse[0]["Id"] <=0) {//不存在，需添加一条主辅导课程
                           //            var addremed = '{"UserId":' + userid +
                           //                         ',"CoursesId":' + userZhuCourse +
                           //                         ',"IsMain":' + 1 +
                           //                         '}';
                           //            $.post("http://{{.Website}}/orange/remedialcourses/AddRemedialcourses/", addremed,
                           //                function (dataadd) {
                           //                    if (dataadd["id"] > 0) {
                           //                    } else { alert("辅助信息保存失败！"); }
                           //                });
                           //        } else {//存在，修改一条主辅导课程
                           //            var upremed = '{"UserId":' + datacourse[0]["UserId"] +
                           //                         ',"CoursesId":' + userZhuCourse +
                           //                         ',"IsMain":' + datacourse[0]["IsMain"] +
                           //                         '}';
                           //            $.post("http://{{.Website}}/orange/remedialcourses/UpdateRemedialcoursesById/" + datacourse[0]["Id"], upremed,
                           //                function (dataup) {
                           //                    if (dataup == "OK") {
                           //                    } else { alert("辅助信息保存失败！"); }
                           //                });
                           //        }
                           //    });
                           //}
                           //------------保存主辅导课程结束
                           //------------保存辅辅导课程开始
                           var allselclassid = "";
                           for (var i = 0; i < 12; i++) {
                               var items = document.getElementById("ckclass" + i);
                               if (items != null) {
                                   if (items.checked) {
                                       allselclassid = allselclassid + items.value + ",";
                                   }
                               }
                           }
                           allselclassid = allselclassid.substring(0, allselclassid.length - 1);
                           //alert(allselclassid);
                           var allContry = "http://{{.Website}}/orange/remedialcourses/UpdateStudentClassTeacher/" + userid + "/" + allselclassid + "/" + userZhuCourse;
                           $.getJSON(allContry, function (data) {
                               
                           });
                           //------------保存辅辅导课程结束
                           alert("修改成功！");
                           window.location.href = "http://{{.Website}}/orange/Main/UpdateTeacher/";
                           document.getElementById("btnsaveuser").style.display = "none";
                       } else {
                           alert("修改失败！");
                       }
                   });

            });
        }

        //保存用户密码
        function saveUserPass() {
            var oldpass = trim(document.getElementById("oldpass").value);
            var newpass1 = trim(document.getElementById("newpass1").value);
            var newpass2 = trim(document.getElementById("newpass2").value);
            if (oldpass == "") { alert("请输入原始密码！"); return; }
            if (newpass1 == "") { alert("请输入新密码！"); return; }
            if (newpass2 == "") { alert("请再次输入重复新密码！"); return; }
            if (newpass1 != newpass2) { alert("两次输入的新密码不一样！"); return; }
            var yanzhengpass = "http://{{.Website}}/orange/userinformation/GetUserinformationById/" + userid;
            $.getJSON(yanzhengpass, function (datauser) {
                if (datauser["LoginPassword"] == oldpass) {
                    //alert(datauser);
                    var upuser = '{' +
                        '"UserName":"' + datauser["UserName"] + '",' +
                        '"IphoneNum":"' + datauser["IphoneNum"] + '",' +
                        '"LoginPassword":"' + newpass1 + '",' +
                        '"PayPassword":"' + datauser["PayPassword"] + '",' +
                        '"UserSex":"' + datauser["UserSex"] + '",' +
                        '"SchoolId":' + datauser["SchoolId"] + ',' +
                        '"SchoolName":"' + datauser["SchoolName"] + '",' +
                        '"SchoolAgeId":' + datauser["SchoolAgeId"] + ',' +
                        '"UserDegree":' + datauser["UserDegree"] + ',' +
                        '"UserLocation":' + datauser["UserLocation"] + ',' +
                        '"SeniorLocation":' + datauser["SeniorLocation"] + ',' +
                        '"HighSchool":"' + datauser["HighSchool"] + '",' +
                        '"UserLevelId":' + datauser["UserLevelId"] + ',' +
                        '"LevelYear":' + datauser["LevelYear"] + ',' +
                        '"IdentityId":' + datauser["IdentityId"] + ',' +
                        '"GradeId":' + datauser["GradeId"] + ',' +
                        '"SchoolAgeIdT":"' + datauser["SchoolAgeIdT"] + '",' +
                        '"UnitPrice":' + datauser["UnitPrice"] + ',' +
                        '"Professional":"' + datauser["Professional"] + '",' +
                        '"Mailbox":"' + datauser["Mailbox"] + '",' +
                        '"ParentMailbox":"' + datauser["ParentMailbox"] + '",' +
                        '"StudyDifficult":"' + datauser["StudyDifficult"] + '",' +
                        '"AvatarPath":"' + datauser["AvatarPath"] + '",' +
                        '"UserHobby":"' + datauser["UserHobby"] + '",' +
                        '"Remarks":"' + datauser["Remarks"] + '",' +
                        '"BriefIntroduction":"' + datauser["BriefIntroduction"] + '",' +
                        '"RegisteredTime":"' + getInsertDate(datauser["RegisteredTime"]) +
                    '"}';
                    $.post("http://{{.Website}}/orange/userinformation/UpdateUserinformationById/" + userid, upuser,
                       function (data) {
                           if (data == "OK") {
                               alert("修改成功！");
                               window.location.href = "http://{{.Website}}/orange/Main/UpdateTeacher/";
                           } else {
                               alert("修改失败！");
                           }
                       });
                } else {
                    alert("原始密码输入错误，请重新输入！");
                    document.getElementById("oldpass").value = "";
                    document.getElementById("newpass1").value = "";
                    document.getElementById("newpass2").value = "";
                }
            });
        }

        var phoneistorf = 0;//false
        var xianColor = "#fe9627";
        var yinColor = "#c4c4c4";
        function yanzheng() {
            var oldphone = document.getElementById("olduserphone").innerText;
            var phone = document.getElementById("upuserphone").value;
            if (trim(oldphone) == trim(phone)) { alert("修改的手机不能与旧手机号一样！"); return; }
        }
        //验证手机号码，并且改变获取验证码按钮的颜色
        function upColor() {
            var phone = document.getElementById("upuserphone").value;
            var re = /^1\d{10}$/;
            if (re.test(phone)) {
                var oldphone = document.getElementById("olduserphone").innerText;
                if (trim(oldphone) == trim(phone)) {
                    alert("修改的手机不能与旧手机号一样！");
                    return;
                }
                var getphoneuser = "http://{{.Website}}/orange/userinformation/GetUserinformationByPhone/" + phone;
                $.getJSON(getphoneuser, function (datas) {
                    if (datas != null && datas["result"] == 1) {
                        alert("此手机号已经注册，不能重复使用！");
                    } else {
                        document.getElementById("getyanzheng").style.backgroundColor = xianColor;//手机号码输入正确获取验证码按钮变为显色
                        document.getElementById("getyanzheng").disabled = false;
                        phoneistorf = 1;
                    }
                });
            } else {
                document.getElementById("getyanzheng").style.backgroundColor = yinColor;//手机号码输入错误获取验证码按钮不显色
                phoneistorf = 0;
            }
        }
        var nowPhone = "";//为了保证删除时删除的是发送时的手机号
        function getYzCode() {
            var phone = document.getElementById("upuserphone").value;
            nowPhone = phone;
            //发送验证码
            if (phoneistorf == 1) {
                $.getJSON("http://{{.Website}}/orange/verification/GetVerification/" + phone, function (data) {
                    alert("发送成功");
                    var btn = document.getElementById("getyanzheng");
                    time(btn);
                });
            } else {
                alert("手机号输入不正确！请输入正确手机号码！");
            }
        }

        //确认修改手机号码
        function saveUserPhone() {
            var oldphone = document.getElementById("olduserphone").innerText;
            var phone = trim(document.getElementById("upuserphone").value);
            var useryanzheng = document.getElementById("upyanzhengma").value;
            if (phone + "" == "") {
                alert("请先填写您要修改的手机号");
                return;
            } if (trim(useryanzheng) + "" == "") {
                alert("验证码不能为空");
                return;
            }
            if (trim(oldphone) == trim(phone)) {
                alert("修改的手机不能与旧手机号一样！");
                return;
            }//先验证验证码是否正确
            var allCode = "http://{{.Website}}/orange/verification/GetVerificationByPhone/" + phone;
            $.getJSON(allCode, function (data) {
                if (data["VerCode"] == "") {
                    alert("暂无验证码！");
                } else if (useryanzheng == data["VerCode"]) {
                    var upphone = "http://{{.Website}}/orange/userinformation/GetUserinformationById/" + userid;
                    $.getJSON(upphone, function (datauser) {
                        //alert(datauser);
                        var upuser = '{' +
                            '"UserName":"' + datauser["UserName"] + '",' +
                            '"IphoneNum":"' + trim(phone) + '",' +
                            '"LoginPassword":"' + datauser["LoginPassword"] + '",' +
                            '"PayPassword":"' + datauser["PayPassword"] + '",' +
                            '"UserSex":"' + datauser["UserSex"] + '",' +
                            '"SchoolId":' + datauser["SchoolId"] + ',' +
                            '"SchoolName":"' + datauser["SchoolName"] + '",' +
                            '"SchoolAgeId":' + datauser["SchoolAgeId"] + ',' +
                            '"UserDegree":' + datauser["UserDegree"] + ',' +
                            '"UserLocation":' + datauser["UserLocation"] + ',' +
                            '"SeniorLocation":' + datauser["SeniorLocation"] + ',' +
                            '"HighSchool":"' + datauser["HighSchool"] + '",' +
                            '"UserLevelId":' + datauser["UserLevelId"] + ',' +
                            '"LevelYear":' + datauser["LevelYear"] + ',' +
                            '"IdentityId":' + datauser["IdentityId"] + ',' +
                            '"GradeId":' + datauser["GradeId"] + ',' +
                            '"SchoolAgeIdT":"' + datauser["SchoolAgeIdT"] + '",' +
                            '"UnitPrice":' + datauser["UnitPrice"] + ',' +
                            '"Professional":"' + datauser["Professional"] + '",' +
                            '"Mailbox":"' + datauser["Mailbox"] + '",' +
                            '"ParentMailbox":"' + datauser["ParentMailbox"] + '",' +
                            '"StudyDifficult":"' + datauser["StudyDifficult"] + '",' +
                            '"AvatarPath":"' + datauser["AvatarPath"] + '",' +
                            '"UserHobby":"' + datauser["UserHobby"] + '",' +
                            '"Remarks":"' + datauser["Remarks"] + '",' +
                            '"BriefIntroduction":"' + datauser["BriefIntroduction"] + '",' +
                            '"RegisteredTime":"' + getInsertDate(datauser["RegisteredTime"]) +
                        '"}';
                        $.post("http://{{.Website}}/orange/userinformation/UpdateUserinformationById/" + userid, upuser,
                           function (data) {
                               if (data == "OK") {
                                   alert("修改成功！");
                                   delPhoneVerifica();
                                   window.location.href = "http://{{.Website}}/orange/Main/UpdateStudent/";
                               } else {
                                   alert("修改失败！");
                               }
                           });
                    });
                }
            });
        }
        //显示选择照片
        function setImagePreview() {
            var docObj = document.getElementById("file_image");
            var imgObjPreview = document.getElementById("userhead");
            imgObjPreview.src = window.URL.createObjectURL(docObj.files[0]);
            return true;
        }
        function setImagePreview2() {
            var docObj = document.getElementById("file");
            var imgObjPreview = document.getElementById("userhead");
            imgObjPreview.src = window.URL.createObjectURL(docObj.files[0]);
            return true;
        }
        //验证码倒计时结束后删除此手机下的所有验证信息
        function delPhoneVerifica() {
            $.getJSON("http://{{.Website}}/orange/verification/DeleteVerificationByPhone/" + nowPhone, function (data) {

            });
        }

        function check() {
            var username = trim(document.getElementById("txtUserName").value);           
            if (username == "") {
                alert("用户名不能为空，请填写用户名"); return false;
            } else if (nametorf) {
                return true;
            } else {
                alert("此昵称已有人使用，请更换其他昵称！");
                return false;
            }
        }
        var nametorf = true;
        function checkname() {
            var username = trim(document.getElementById("txtUserName").value);
            var geturlname = "http://{{.Website}}/orange/userinformation/GetUserinformationOneByName/" + username;
            $.getJSON(geturlname, function (data) {
                if (data != null && data["Id"] > 0) {
                    if (data["Id"] == userid) {//自己名字
                        nametorf = true;
                    } else {//此昵称已有人使用
                        nametorf = false;
                    }
                } else {//没人用
                    nametorf = true;
                }
            });
        }
    </script>
</body>
</html>
